<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>micro:bitæ–‡å­—åˆ—é€ä¿¡</title>
</head>
<body>
  <h2>micro:bitã¸æ–‡å­—åˆ—é€ä¿¡</h2>
  <input type="text" id="inputText" placeholder="é€ä¿¡ã™ã‚‹æ–‡å­—åˆ—">
  <button id="connect">micro:bitã«æ¥ç¶š</button>
  <button id="send">é€ä¿¡</button>

  <script>
    const UART_SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
    const UART_TX_CHAR_UUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e'; // â† TXç‰¹æ€§ï¼ˆé€ä¿¡ï¼‰

    let txChar = null;

    async function connectMicrobit() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'BBC micro:bit' }],
          optionalServices: [UART_SERVICE_UUID]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(UART_SERVICE_UUID);
        txChar = await service.getCharacteristic(UART_TX_CHAR_UUID);
        console.log("âœ… micro:bitã«æ¥ç¶šã•ã‚Œã¾ã—ãŸ");
      } catch (error) {
        console.error("âŒ æ¥ç¶šå¤±æ•—:", error);
      }
    }

    async function sendToMicrobit() {
      if (!txChar) {
        alert("micro:bitã«æ¥ç¶šã—ã¦ãã ã•ã„");
        return;
      }
      const value = document.getElementById('inputText').value;
      const data = new TextEncoder().encode(value + "\n");
      await txChar.writeValue(data);
      console.log("ğŸ“¤ é€ä¿¡:", value);
    }

    document.getElementById('connect').addEventListener('click', connectMicrobit);
    document.getElementById('send').addEventListener('click', sendToMicrobit);
  </script>
</body>
</html>
