<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>micro:bit文字列送信</title>
</head>
<body>
  <h2>micro:bitへ文字列送信</h2>
  <input type="text" id="inputText" placeholder="送信する文字列">
  <button id="connect">micro:bitに接続</button>
  <button id="send">送信</button>

  <script>
    const UART_SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
    const UART_TX_CHAR_UUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e'; // ← TX特性（送信）

    let txChar = null;

    async function connectMicrobit() {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'BBC micro:bit' }],
          optionalServices: [UART_SERVICE_UUID]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(UART_SERVICE_UUID);
        txChar = await service.getCharacteristic(UART_TX_CHAR_UUID);
        console.log("✅ micro:bitに接続されました");
      } catch (error) {
        console.error("❌ 接続失敗:", error);
      }
    }

    async function sendToMicrobit() {
      if (!txChar) {
        alert("micro:bitに接続してください");
        return;
      }
      const value = document.getElementById('inputText').value;
      const data = new TextEncoder().encode(value + "\n");
      await txChar.writeValue(data);
      console.log("📤 送信:", value);
    }

    document.getElementById('connect').addEventListener('click', connectMicrobit);
    document.getElementById('send').addEventListener('click', sendToMicrobit);
  </script>
</body>
</html>
